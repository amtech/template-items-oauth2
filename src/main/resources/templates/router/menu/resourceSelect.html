<link rel="stylesheet" type="text/css" href="/static/js/plugin/layui/v2/css/layui.css"/>
<div style="margin: 10px;">
    <div class="layui-row">
        <div class="layui-col-md12">
            <div class="layui-inline">
                <input class="layui-input" name="name" id="searchName" placeholder="资源名称"
                       style="height: 30px;line-height: 30px;">
            </div>
            <button class="layui-btn layui-btn-small" id="searchNameBtn">搜索</button>
            <table id="select-resource-table" lay-filter="selectResource"></table>
        </div>
    </div>
</div>
<script type="text/html" id="bar">
    <a class="layui-btn layui-btn-primary layui-btn-mini" lay-event="checkResource"><i class="layui-icon">&#xe618;</i>
    </a>
</script>
<script src="/static/js/plugin/layui/v2/layui.all.js"></script>
<script type="text/javascript">
    var $ = layui.$;
    var laytable = layui.table;
    $(function () {
        var tableIns = laytable.render({
            elem: "#select-resource-table",
            width: 820,
            height: 440,
            url: '/oauth2/resource/api/selectResources',
            where: {
                systemModuleCode: parent.app.menu.systemCode
            },
            page: true,
            limit: 20,
            even: true,
            cols: [[
                {field: 'id', width: 100, title: "ID", fixed: true, align: 'center'},
                {field: 'name', width: 300, title: "资源名称", align: 'center'},
                {field: 'url', width: 300, title: "资源url", align: 'center'},
                {fixed: 'right', width: 98, title: "勾选操作", align: 'center', toolbar: '#bar'}
            ]]
        });

        $("#searchNameBtn").click(function () {
            tableIns.reload({
                where: {
                    name: $("#searchName").val()
                }
            })
        })

        laytable.on('tool(selectResource)', function (obj) {
            var data = obj.data;
            if (obj.event === 'checkResource') {
                parent.app.menu.resourceId = data.id;
                var index = parent.layer.getFrameIndex(window.name);
                parent.layer.close(index);
            }
        })
    });
</script>

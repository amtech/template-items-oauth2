<style type="text/css">
    .dl {
        display: inline-block;
    }

    .dl > .checkbox > input[type=checkbox] {
        margin-left: 10px;
    }
</style>
<div id="sys_param_dialog" class="hideen">
    <!--添加弹出的窗口-->
    <div id="add_sys_param_dialog">
        <form class="form-horizontal" @submit.prevent="handleSubmit_add" method="post">
            <fieldset>
                <!--名称-->
                <div class="form-group" v-bind:class="{ 'has-error': error.nameError }">
                    <label class="col-md-2 control-label">名称</label>
                    <div class="col-md-10">
                        <input class="form-control" type="text"
                               v-model="sysParam.name">
                        <div class="note-error margin-bottom-0"
                             v-bind:class="{ 'has-error text-danger margin-top-10': error.nameError }">
                            {{error.nameErrorMsg}}
                        </div>
                    </div>
                </div>
                <!--值-->
                <div class="form-group" v-bind:class="{ 'has-error': error.valueError }">
                    <label class="col-md-2 control-label">值</label>
                    <div class="col-md-10">
                        <input class="form-control" type="text"
                               v-model="sysParam.value">
                        <div class="note-error margin-bottom-0"
                             v-bind:class="{ 'has-error text-danger margin-top-10': error.valueError }">
                            {{error.valueErrorMsg}}
                        </div>
                    </div>
                </div>
                <!--是否可用-->
                <div class="form-group" v-bind:class="{ 'has-error': error.enabledError }">
                    <label class="col-md-2 control-label">是否可用</label>
                    <div class="col-md-10">
                        <label class="radio radio-inline">
                            <input type="radio" v-model="sysParam.enabled"
                                   class="radiobox style-0"
                                   v-bind:value="true" checked>
                            <span>是</span>
                        </label>
                        <label class="radio radio-inline">
                            <input type="radio" v-model="sysParam.enabled"
                                   class="radiobox style-0"
                                   v-bind:value="false" checked>
                            <span>否</span>
                        </label>
                        <div class="note-error margin-bottom-0"
                             v-bind:class="{ 'has-error text-danger margin-top-10': error.enabledError }">
                            {{error.enabledErrorMsg}}
                        </div>
                    </div>
                </div>
                <!--排序-->
                <div class="form-group" v-bind:class="{ 'has-error': error.orderError }">
                    <label class="col-md-2 control-label">排序</label>
                    <div class="col-md-10">
                        <input class="form-control" type="number"
                               v-model="sysParam.orderIndex">
                        <div class="note-error margin-bottom-0"
                             v-bind:class="{ 'has-error text-danger margin-top-10': error.orderError }">
                            {{error.orderErrorMsg}}
                        </div>
                    </div>
                </div>
                <!--备注-->
                <div class="form-group">
                    <label class="col-md-2 control-label">备注</label>
                    <div class="col-md-10">
                        <input class="form-control" placeholder="备注信息（选填）" type="text"
                               v-model="sysParam.remark">
                    </div>
                </div>
            </fieldset>
            <button id="add" type="submit" class="hidden"></button>
        </form>
    </div>
    <!--编辑弹出的窗口-->
    <div id="edit_sys_param_dialog">
        <form id="edit-sys-param-form" class="form-horizontal" @submit.prevent="handleSubmit_edit"
              method="post">
            <fieldset>
                <!--名称-->
                <div class="form-group" v-bind:class="{ 'has-error': error.nameError }">
                    <label class="col-md-2 control-label">名称</label>
                    <div class="col-md-10">
                        <input class="form-control" type="text"
                               v-model="sysParam.name">
                        <div class="note-error margin-bottom-0"
                             v-bind:class="{ 'has-error text-danger margin-top-10': error.nameError }">
                            {{error.nameErrorMsg}}
                        </div>
                    </div>
                </div>
                <!--值-->
                <div class="form-group" v-bind:class="{ 'has-error': error.valueError }">
                    <label class="col-md-2 control-label">值</label>
                    <div class="col-md-10">
                        <input class="form-control" type="text"
                               v-model="sysParam.value">
                        <div class="note-error margin-bottom-0"
                             v-bind:class="{ 'has-error text-danger margin-top-10': error.valueError }">
                            {{error.valueErrorMsg}}
                        </div>
                    </div>
                </div>
                <!--是否可用-->
                <div class="form-group" v-bind:class="{ 'has-error': error.enabledError }">
                    <label class="col-md-2 control-label">是否可用</label>
                    <div class="col-md-10">
                        <label class="radio radio-inline">
                            <input type="radio" v-model="sysParam.enabled"
                                   class="radiobox style-0"
                                   v-bind:value="true" checked>
                            <span>是</span>
                        </label>
                        <label class="radio radio-inline">
                            <input type="radio" v-model="sysParam.enabled"
                                   class="radiobox style-0"
                                   v-bind:value="false" checked>
                            <span>否</span>
                        </label>
                        <div class="note-error margin-bottom-0"
                             v-bind:class="{ 'has-error text-danger margin-top-10': error.enabledError }">
                            {{error.enabledErrorMsg}}
                        </div>
                    </div>
                </div>
                <!--排序-->
                <div class="form-group" v-bind:class="{ 'has-error': error.orderError }">
                    <label class="col-md-2 control-label">排序</label>
                    <div class="col-md-10">
                        <input class="form-control" type="number"
                               v-model="sysParam.orderIndex">
                        <div class="note-error margin-bottom-0"
                             v-bind:class="{ 'has-error text-danger margin-top-10': error.orderError }">
                            {{error.orderErrorMsg}}
                        </div>
                    </div>
                </div>
                <!--备注-->
                <div class="form-group">
                    <label class="col-md-2 control-label">备注</label>
                    <div class="col-md-10">
                        <input class="form-control" placeholder="备注信息（选填）" type="text"
                               v-model="sysParam.remark">
                    </div>
                </div>

            </fieldset>
            <button id="edit" type="submit" class="hidden"></button>
        </form>
    </div>
</div>
<!-- row -->
<div class="row">
    <div id="toolbar" class="form-inline">
        <a href="javascript:;" id="add_dialog_link" class="btn btn-info btn-sm"> <i class="fa fa-plus-square-o"></i> 添加
        </a>
        <a href="javascript:;" id="edit_dialog_link" class="btn btn-warning btn-sm"><i class="fa fa-pencil-square "></i>
            编辑</a>
        <button id="delete-menu" class="btn btn-danger btn-sm"
                rel="tooltip" data-placement="bottom"
                data-reset-msg="您确定要删除所选项吗？"><i class="fa fa-minus-square-o"></i> 删除
        </button>
        &nbsp;
        <select name="selectEnabled" class="form-control">
            <option value="">是否可用(全选)</option>
            <option value="true">是</option>
            <option value="false">否</option>
        </select>
        <button id="search-menu" class="btn btn-default btn-sm"><i class="fa fa-search"></i> 搜索</button>
    </div>
    <!-- NEW WIDGET START -->
    <article class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <table id="table">
            <thead>
            <tr>
                <th data-checkbox="true"></th>

                <th data-field="id" data-sortable="true"
                    data-width="100"
                    data-title="ID" data-align="center"></th>

                <th data-field="name" data-sortable="true"
                    data-width="170"
                    data-filter-control="input"
                    data-filter-control-placeholder="输入名称"
                    data-title="名称" data-align="center"></th>

                <th data-field="value" data-sortable="true"
                    data-filter-control="input"
                    data-filter-control-placeholder="输入值"
                    data-title="值" data-align="center"
                    data-width="170"></th>

                <th data-field="enabled"
                    data-title="是否可用"
                    data-formatter="enabledFormatter"
                    data-width="90"
                    data-align="center"></th>

                <th data-field="updateDate"
                    data-sort-name="update_date"
                    data-sortable="true"
                    data-title="修改时间"
                    data-formatter="date_formatter"
                    data-align="center"></th>


                <th data-field="createDate"
                    data-sort-name="create_date"
                    data-formatter="date_formatter"
                    data-sortable="true"
                    data-title="创建日期"
                    data-align="center"></th>


                <th data-field="updateUserName"
                    data-sort-name="update_user_name"
                    data-sortable="true"
                    data-title="修改人"
                    data-align="center"></th>

                <th data-field="createUserName"
                    data-sort-name="create_user_name"
                    data-sortable="true"
                    data-title="创建人"
                    data-align="center"></th>

                <th data-field="orderIndex"
                    data-sort-name="order_Index"
                    data-sortable="true"
                    data-title="排序"
                    data-align="center"></th>

                <th data-field="remark"
                    data-sortable="true"
                    data-title="备注"
                    data-align="center"></th>
            </tr>
            </thead>
        </table>
    </article>
    <!-- WIDGET END -->

</div>

<script type="text/javascript">

    pageSetUp();

    // page_function
    var page_function = function () {
        var $table = $("#table");
        var query_params = function (params) {
            var temp = {
                limit: params.limit,
                offset: params.offset,
                order: params.order,
                sort: params.sort,
                name: $("input.bootstrap-table-filter-control-name").val(),
                value: $("input.bootstrap-table-filter-control-value").val(),
                search: params.search,
                selectEnabled: $("select[name=selectEnabled]").val(),
            }
            return temp;
        };

        var app = new Vue({
            el: "#sys_param_dialog",
            data: {
                sysParam: {
                    id: '',
                    name: '',
                    value: '',
                    enabled: true,
                    orderIndex: null,
                    remark: ''
                },
                error: {
                    nameError: false,
                    nameErrorMsg: '',
                    valueError: false,
                    valueErrorMsg: '',
                    orderError: false,
                    orderErrorMsg: ''
                }
            },
            computed: {
                errors: function () {
                    return this.$vuerify.$errors // 错误信息会在 $vuerify.$errors 内体现
                }
            },
            methods: {
                handleSubmit_add: function () {
                    this.$vuerify.clear()//清空之前的验证结果信息
                    var check_result = this.$vuerify.check()// 手动触发校验所有数据
                    var $errs = this.$vuerify.$errors

                    app.error.nameError = Boolean($errs.name)
                    app.error.nameErrorMsg = $errs.name
                    app.error.valueError = Boolean($errs.value)
                    app.error.valueErrorMsg = $errs.value
                    app.error.orderError = Boolean($errs.orderIndex)
                    app.error.orderErrorMsg = $errs.orderIndex

                    if (!check_result) {
                        TF.show_error_message("错误消息提示", "请修正表单错误信息之后再提交", 3000)
                    } else {
                        var params = new URLSearchParams();
                        var datas = app.sysParam
                        for (var data in datas) {
                            params.append(data, datas[data])
                        }
                        axios.post('/sysparam/api/add', params)
                            .then(function (response) {
                                if (response.data.code == TF.STATUS_CODE.SUCCESS) {
                                    layer.msg(response.data.message);
                                    setTimeout(function () {
                                        $('#add_sys_param_dialog').dialog('close');
                                        $table.bootstrapTable('refresh');
                                    })
                                } else {
                                    TF.show_error_msg(response.data.message)
                                }
                            })
                            .catch(function (error) {
                                TF.show_error_msg(error.response.data.message)
                            });
                    }
                    return false;
                },
                handleSubmit_edit: function () {
                    this.$vuerify.clear()//清空之前的验证结果信息
                    var check_result = this.$vuerify.check()// 手动触发校验所有数据
                    var $errs = this.$vuerify.$errors
                    app.error.nameError = Boolean($errs.name)
                    app.error.nameErrorMsg = $errs.name
                    app.error.valueError = Boolean($errs.value)
                    app.error.valueErrorMsg = $errs.value
                    app.error.orderError = Boolean($errs.orderIndex)
                    app.error.orderErrorMsg = $errs.orderIndex

                    if (!check_result) {
                        TF.show_error_message("错误消息提示", "请修正表单错误信息之后再提交", 3000)
                    } else {
                        var params = new URLSearchParams();
                        var datas = app.sysParam
                        for (var data in datas) {
                            params.append(data, datas[data])
                        }
                        axios.post('/sysparam/api/edit', params)
                            .then(function (response) {
                                if (response.data.code == TF.STATUS_CODE.SUCCESS) {
                                    layer.msg(response.data.message);
                                    setTimeout(function () {
                                        $('#edit_sys_param_dialog').dialog('close');
                                        $table.bootstrapTable('refresh');
                                    })
                                } else {
                                    TF.show_error_msg(response.data.message)
                                }
                            })
                            .catch(function (error) {
                                TF.show_error_msg(error.response.data.message)
                            });
                    }
                    return false;
                }
            },
            vuerify: {
                name: {
                    test: function () {
                        return String(app.sysParam.name).length >= 2
                    },
                    message: '名字长度不能为空且不能过短'
                },
                value: {
                    test: function () {
                        return String(app.sysParam.value).length > 0
                    },
                    message: '值不能为空'
                },
                orderIndex: {
                    test: function () {
                        return !isNaN(app.sysParam.orderIndex)
                    },
                    message: '不能为空且必须为数字'
                }
            }

    })

        $table.bootstrapTable({
            sidePagination: "server",
            url: "/sysparam/api/list",
            toolbar: '#toolbar',
            showRefresh: true,
            method: 'post',
            contentType: "application/x-www-form-urlencoded; charset=UTF-8",//post方式一定得改成这种contentType
            queryParams: query_params,
            height: getHeight(),
            sortName: 'id',//第一次进默认的排序字段
            sortOrder: 'asc',
            idField: "id",
            uniqueId: 'id',
            checkboxHeader: true,
            clickToSelect: true,
            showColumns: true,
            silentSort: false,
            maintainSelected: true,
            striped: true,
            cache: false,
            pagination: true,
            paginationLoop: false,
            pageList: '[10,25,50,150]',
            escape: true,
            filterControl: true,
            filterShowClear: true,
            searchTimeOut: 1000
        });


        // Dialog click
        $('#add_dialog_link').click(function () {
            app.sysParam.name = ''
            app.sysParam.enabled = true
            app.sysParam.value = ''
            app.sysParam.orderIndex = 0
            app.sysParam.remark = ''
            $('#add_sys_param_dialog').dialog('open');
            return false;
        });

        <!--添加dialog-->
        $('#add_sys_param_dialog').dialog({
            autoOpen: false,
            width: 500,
            resizable: true,
            modal: true,
            title: "<div class='widget-header'><h4><i class='icon-ok'></i> 添加系统参数</h4></div>",
            buttons: [{
                html: "<i class='fa fa-plus-square-o'></i>&nbsp; 添加",
                "class": "btn btn-info",
                click: function () {

                    $("#add").trigger("click");
                }
            }, {
                html: "<i class='fa fa-times'></i>&nbsp; 取消",
                "class": "btn btn-default",
                click: function () {
                    $(this).dialog("close");
                }
            }]
        });

        <!--编辑dialog-->
        $('#edit_dialog_link').click(function () {
            //判断是否只选中一条信息
            if ($table.bootstrapTable('getSelections').length > 1) {
                TF.show_error_msg("只能选择一条信息进行编辑")
            } else if ($table.bootstrapTable('getSelections').length < 1) {
                TF.show_error_msg("请选择您想要编辑的信息")
            }
            //将选中的信息自动显示
            else {
                $('#edit_sys_param_dialog').dialog('open');
                //获取选中的对象
                var $editsysParam = $table.bootstrapTable('getSelections')[0];
                //把获取到的对象赋值给当前页面上的元素
                app.sysParam.id = $editsysParam.id
                app.sysParam.name = $editsysParam.name
                app.sysParam.enabled = $editsysParam.enabled
                app.sysParam.value = $editsysParam.value
                app.sysParam.orderIndex = $editsysParam.orderIndex
                app.sysParam.remark = $editsysParam.remark
            }
            return false;
        });
        //编辑系统参数dialog
        $('#edit_sys_param_dialog').dialog({
            autoOpen: false,
            width: 500,
            resizable: true,
            modal: true,
            title: "<div class='widget-header'><h4><i class='icon-ok'></i> 编辑系统参数</h4></div>",
            buttons: [{
                html: "<i class='fa fa-plus-square-o'></i>&nbsp; 编辑",
                "class": "btn btn-info",
                click: function () {
                    $("#edit").trigger("click");
                }
            }, {
                html: "<i class='fa fa-times'></i>&nbsp; 取消",
                "class": "btn btn-default",
                click: function () {
                    $(this).dialog("close");
                }
            }]
        });
        //调整窗口大小
        $(window).resize(function () {
            $table.bootstrapTable('resetView', {
                height: getHeight()
            });
        })

        //监听搜索按钮事件
        $("#search-menu").click(function () {
            var opt = {
                url: "/sysparam/api/list",
                silent: true,
                query: {
                    name: $("input.bootstrap-table-filter-control-name").val(),
                    value: $("input.bootstrap-table-filter-control-value").val(),
                }
            }
            $table.bootstrapTable('refresh', opt);
        })
        //监听删除按钮事件
        $("#delete-menu").click(function () {
            if ($table.bootstrapTable('getSelections').length < 1) {
                $.SmartMessageBox({
                    title: "<i class='fa fa-minus-square-o' style='color:red'></i>  删除",
                    content: $this.data('reset-msg') || "至少选择一条信息进行删除！",
                    buttons: '[取消]'
                });
            }
            else {
                $.SmartMessageBox({
                    title: "<i class='fa fa-minus-square-o' style='color:red'></i> 确认要删除吗？",
                    content: $this.data('reset-msg') || "您确定要删除所选择的所有信息吗?",
                    buttons: '[取消][确认]'
                }, function (ButtonPressed) {
                    if (ButtonPressed == "确认" && localStorage) {
                        var _ids = ""
                        for (var i = 0; i < $table.bootstrapTable('getSelections').length; i++) {
                            _ids += $table.bootstrapTable('getSelections')[i].id + ","
                        }
                        _ids = _ids.substr(0, _ids.length - 1);
                        axios.post('/sysparam/api/del?_ids=' + _ids)
                            .then(function (response) {
                                if (response.data.code == TF.STATUS_CODE.SUCCESS) {
                                    layer.msg(response.data.message);
                                    setTimeout(function () {
                                        $table.bootstrapTable("refresh")
                                    })
                                } else {
                                    TF.show_error_msg(response.data.message)
                                }
                            })
                            .catch(function (error) {
                                TF.show_error_msg(error.response.data.message)
                            });
                    }
                });
            }
        })
        //监听是否可用
        $("select[name=selectEnabled]").change(function () {
            app.sysParam.enabled = $(this).find('option:selected').val()
            $table.bootstrapTable("refresh");
        })
    };
    //获取高度
    function getHeight() {
        return $(window).height() - $('header').outerHeight(true)
            - $('div.page-footer').outerHeight(true)
            - $('#ribbon').outerHeight(true)
            - 25
    }
    //格式化 enable
    function enabledFormatter(enabled) {
        return enabled ? "<label class='label label-success'>是</label>" : "<label class='label label-danger'>否</label>";
    }
    //格式化 日期
    function date_formatter(date) {
        return date.year + "-" + date.monthValue + "-" + date.dayOfMonth + " " + date.hour + ":" + date.minute + ":" + date.second;
    }


    loadScript("/static/js/libs/vue/axios.min.js", function () {
        loadScript("/static/js/libs/vue/vuerify.min.js", function () {
            loadScript("/static/js/libs/vue/url-search-params.min.js", page_function())
        })
    })


</script>
